<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Collecte de données — Simulation (Exercice)</title>
  <style>
    :root{
      --bg:#ffffff; --panel:#f4fdf4; --accent:#2e7d32; --text:#1b1b1b; --muted:#4d6651; --danger:#d32f2f; --ok:#388e3c;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:20px auto;padding:18px}
    .card{background:var(--panel);border-radius:var(--radius);padding:12px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:64px;border-radius:8px}
    h1{margin:0;color:var(--accent);font-size:1.1rem}
    form{margin-top:12px;display:grid;gap:10px}
    label{font-size:.9rem;color:var(--muted);display:block;margin-bottom:6px}
    input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,.08)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .muted{color:var(--muted);font-size:.88rem}
    .buttons{display:flex;gap:8px;align-items:center}
    /* MASQUER les contrôles publics (export/changer logo/copier) */
    #exportCsvBtn, #exportXlsxBtn, #changeLogoBtn, #copyLinkBtn { display: none !important; }
    .notice {border-left:4px solid var(--accent);padding:10px;background:#f6fff6;border-radius:8px;color:var(--muted)}
    .danger-note {border-left:4px solid var(--danger);background:#fff6f6}
    .success{color:var(--ok)}
  </style>
</head>
<body>
  <div class="wrap card" role="region" aria-labelledby="title">
    <header>
      <div class="brand">
        <!-- LOGO depuis GitHub raw (remplace TON_USER/TON_REPO/path) -->
        <img id="logo" src="https://raw.githubusercontent.com/TON_USER/TON_REPO/main/assets/logo.png" alt="Logo" onerror="this.style.display='none'" />
        <div>
          <h1 id="title">Collecte de données — Simulation (Exercice)</h1>
          <div class="muted">Page de démonstration — <strong>consentement requis</strong></div>
        </div>
      </div>

      <div class="buttons">
        <!-- Ces boutons sont masqués via CSS pour les participants -->
        <button id="exportCsvBtn">Exporter CSV</button>
        <button id="exportXlsxBtn">Exporter Excel</button>
        <button id="changeLogoBtn">Changer le logo</button>
        <button id="copyLinkBtn">Copier le lien</button>
        <button id="clearBtn" onclick="if(confirm('Réinitialiser le stockage local ?')){localStorage.removeItem('dcf_submissions_v1');alert('Réinitialisé');}">Réinitialiser</button>
      </div>
    </header>

    <div style="margin-top:12px" class="notice">
      <strong>INFO — Simulation pédagogique :</strong>
      Cet exercice est une simulation. <strong>Toute donnée sensible ne doit pas être fournie</strong> — n’entrez pas de mots de passe réels ou d’informations bancaires. Les réponses sont envoyées au serveur pour l’exercice et enregistrées pour correction.
    </div>

    <form id="dataForm" novalidate style="margin-top:14px">
      <label for="fullName">Nom complet *</label>
      <input id="fullName" name="fullName" type="text" required minlength="2" placeholder="Ex. Fofa El Amrani" />

      <div class="row">
        <div>
          <label for="email">Email *</label>
          <input id="email" name="email" type="email" required placeholder="exemple@domaine.com" />
        </div>
        <div>
          <label for="phone">Téléphone (optionnel)</label>
          <input id="phone" name="phone" type="tel" placeholder="+1 514 555 1234" />
        </div>
      </div>

      <label for="role">Rôle / Fonction</label>
      <input id="role" name="role" type="text" placeholder="Étudiante, Analyste SOC..." />

      <label for="operator">Opérateur mobile (optionnel)</label>
      <input id="operator" name="operator" type="text" placeholder="Ex. Bell, Rogers..." />

      <label for="category">Catégorie</label>
      <select id="category" name="category">
        <option value="">— Sélectionner —</option>
        <option>Inscription</option>
        <option>Questionnaire</option>
        <option>Incident</option>
        <option>Recherche</option>
      </select>

      <label for="message">Message / Détails *</label>
      <textarea id="message" name="message" rows="4" required placeholder="Décris l'objectif, le contexte..."></textarea>

      <label for="file">Pièce jointe (optionnel)</label>
      <input id="file" name="file" type="file" accept=".png,.jpg,.pdf,.txt" />

      <!-- Champ honeypot -->
      <div style="position:absolute;left:-9999px;top:auto;">
        <label for="website">Site</label>
        <input id="website" name="website" type="text" autocomplete="off" tabindex="-1" />
      </div>

      <label>
        <input id="consent" name="consent" type="checkbox" required />
        J'accepte que mes réponses soient utilisées uniquement dans le cadre de cet exercice pédagogique.
      </label>

      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="submitBtn" type="submit">Soumettre (simulation)</button>
        <button type="button" onclick="form.reset()">Réinitialiser le formulaire</button>
      </div>
      <div id="status" class="muted" aria-live="polite" style="margin-top:8px"></div>
    </form>
  </div>

  <script>
    // Envoi vers le backend (ex: https://ton-domaine/api/submit)
    const API_ENDPOINT = '/api/submit'; // en local, ou remplace par ton URL complète

    const form = document.getElementById('dataForm');
    const statusEl = document.getElementById('status');

    function fileToBase64(file){ return new Promise((resolve,reject)=>{ if(!file) return resolve(null); const r=new FileReader(); r.onload=()=>resolve(r.result); r.onerror=reject; r.readAsDataURL(file); }); }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      statusEl.textContent = 'Envoi en cours...';

      // honeypot
      if(document.getElementById('website').value.trim()){ statusEl.textContent='Bot détecté'; return; }

      const consent = document.getElementById('consent').checked;
      if(!consent){ statusEl.textContent = 'Consentement requis.'; return; }

      // collect
      const fileInput = document.getElementById('file').files[0];
      const fileData = await fileToBase64(fileInput).catch(()=>null);
      // build payload
      const payload = {
        fullName: document.getElementById('fullName').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        role: document.getElementById('role').value.trim(),
        operator: document.getElementById('operator').value.trim(),
        category: document.getElementById('category').value,
        message: document.getElementById('message').value.trim(),
        fileName: fileInput ? fileInput.name : null,
        fileData, // base64
        consentGiven: true,
        simulated: true // marqueur pédagogique
      };

      // IMPORTANT: NE PAS demander de mots de passe / données bancaires réelles
      try{
        const resp = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!resp.ok) throw new Error('Erreur serveur');
        statusEl.textContent = 'Soumission enregistrée (simulation).';
        form.reset();
      }catch(err){
        console.error(err);
        statusEl.textContent = 'Erreur lors de l’envoi. Voir la console.';
      }
    });
  </script>
</body>
</html>
